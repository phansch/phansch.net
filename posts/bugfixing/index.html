
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Worthwhile bugfixing</title>

    <meta name="author" content="Philipp Hansch" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="alternate" type="application/atom+xml" title="phansch.net - Feed" href="http://phansch.net/atom.xml" />
    <link rel="stylesheet" type="text/css" href="/assets/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/default.css" />
    
<meta name="twitter:site" content="phansch.net">
<meta name="twitter:creator" content="@phansch">
<meta name="twitter:title" content="Worthwhile bugfixing">
<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;phansch.net&#x2F;assets/images/twitter-card-image.jpg">

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" sizes="16x16 32x32" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, user-scalable=no">
  </head>
  <body>
    <nav class="my-top-bar">
      
        <a title="About" href="/" rel="author">About</a> ╵
        <a title="Blog" class="active" href="/writing">Blog</a> ╵
        <a title="Reading List" href="/reading">Reading</a> ╵
        <a title="100+ Rust PRs" href="/onehundred/rust">100+ Rust PRs</a> ╵
        <a title="Sponsor me" href="/thanks">Sponsor me</a>
      
    </nav>

    <a id="top"></a>

    <section class="main">
      
  <div class="post">
    <article class="col h-entry">
      <h1 class="p-name">Worthwhile bugfixing</h1>
      <p class="meta">
      — <a href="https:&#x2F;&#x2F;phansch.net&#x2F;posts&#x2F;bugfixing&#x2F;" class="u-url" title="Permalink">
          <em>
            <time class="dt-published" datetime="2013-11-03">03 Nov 2013</time>
          </em>
      </a>,
      <em>
  
  
  
  3  min read
</em>
      </p>
      <div class="e-content"><p>While I was working on a new version of <a href="https://github.com/phansch/jou">Jou</a>, I suddenly stumbled across a roadblock.</p>
<a href="/assets/images/posts/2013-11-03-bugfixing/rspec_failure.png" class="thumbnail">
  <img src="/assets/images/posts/2013-11-03-bugfixing/rspec_failure.png" alt="screenshot" />
</a>
> What?! Expectation equals result, so why would it fail?!
<p>That was my first thought. </p>
<p>It might be useful to know what the test and <code>get_recent</code> look like.</p>
<p>Here's a breakdown of the spec:</p>
<pre style="background-color:#2b303b;">
<code class="language-ruby" data-lang="ruby"><span style="color:#c0c5ce;">before </span><span style="color:#b48ead;">do
  </span><span style="color:#65737e;"># Create a basic temporary journal file
  </span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">journal_file </span><span style="color:#c0c5ce;">= </span><span style="color:#ebcb8b;">Tempfile</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">jou_test</span><span style="color:#c0c5ce;">&#39;)
  @</span><span style="color:#bf616a;">journal </span><span style="color:#c0c5ce;">= </span><span style="color:#ebcb8b;">Journal</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">(@</span><span style="color:#bf616a;">journal_file</span><span style="color:#c0c5ce;">.path)

  @</span><span style="color:#bf616a;">today </span><span style="color:#c0c5ce;">= </span><span style="color:#ebcb8b;">Date</span><span style="color:#c0c5ce;">.today.strftime(&quot;</span><span style="color:#d08770;">%y</span><span style="color:#a3be8c;">.</span><span style="color:#d08770;">%m</span><span style="color:#a3be8c;">.</span><span style="color:#d08770;">%d</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#b48ead;">end

</span><span style="color:#c0c5ce;">it &quot;</span><span style="color:#a3be8c;">returns a string with entries from today</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#b48ead;">do
  </span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">journal</span><span style="color:#c0c5ce;">.add(&quot;</span><span style="color:#a3be8c;">hi!</span><span style="color:#c0c5ce;">&quot;)
  @</span><span style="color:#bf616a;">journal</span><span style="color:#c0c5ce;">.add(&quot;</span><span style="color:#a3be8c;">ho!</span><span style="color:#c0c5ce;">&quot;)
  @</span><span style="color:#bf616a;">journal</span><span style="color:#c0c5ce;">.get_recent(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">).should == &quot;</span><span style="color:#a3be8c;">### </span><span style="color:#c0c5ce;">#{@</span><span style="color:#bf616a;">today</span><span style="color:#c0c5ce;">}</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;"> * hi!</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;"> * ho!</span><span style="color:#96b5b4;">\n\n</span><span style="color:#c0c5ce;">&quot;
ends
</span></code></pre>
<p>And <code>get_recent</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-ruby" data-lang="ruby"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_recent</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">limit </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">)
  out = &quot;&quot;

  </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.each_pair </span><span style="color:#b48ead;">do </span><span style="color:#c0c5ce;">|</span><span style="color:#bf616a;">date</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">entries</span><span style="color:#c0c5ce;">|
    </span><span style="color:#b48ead;">break if</span><span style="color:#c0c5ce;"> limit == </span><span style="color:#d08770;">0

</span><span style="color:#c0c5ce;">    out &lt;&lt; &quot;</span><span style="color:#a3be8c;">### </span><span style="color:#c0c5ce;">#{date}</span><span style="color:#a3be8c;">­</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
    entries.each { |</span><span style="color:#bf616a;">entry</span><span style="color:#c0c5ce;">| out &lt;&lt; &quot;</span><span style="color:#a3be8c;"> * </span><span style="color:#c0c5ce;">#{entry}</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot; }
    out &lt;&lt; &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
    limit -= </span><span style="color:#d08770;">1
  </span><span style="color:#b48ead;">end

</span><span style="color:#c0c5ce;">  out
</span><span style="color:#b48ead;">end
</span></code></pre>
<p>My first guess was that the failing test was caused by using <code>==</code>. Luckily I've heard about 
different <a href="https://www.relishapp.com/rspec/rspec-expectations/v/2-0/docs/matchers/equality-matchers">equality matchers in rspec</a> before. I looked them up and it turns out that using <code>==</code> is 
indeed the right choice to compare the values of two different objects. </p>
<p>Then I decided to run the test on the command line instead of using <a href="https://packagecontrol.io/packages/RubyTest">RubyTest</a> inside Sublime Text. Maybe, for whatever reason, it would show something that RubyTest doesn't. </p>
<a href="/assets/images/posts/2013-11-03-bugfixing/rspec_failure2.png" class="thumbnail">
  <img src="/assets/images/posts/2013-11-03-bugfixing/rspec_failure2.png" alt="screenshot" />
</a>
<p>Well, how did that hyphen get there and why didn't it show up in Sublime Text?
First, let's see if the hyphen is actually in the file and not just present on the command line. 
I'm using the <a href="https://packagecontrol.io/packages/HexViewer">HexView plugin</a> to check the actual content of the file.</p>
<a href="/assets/images/posts/2013-11-03-bugfixing/hex.png" class="thumbnail">
  <img src="/assets/images/posts/2013-11-03-bugfixing/hex.png" alt="screenshot" />
</a>
<p>Well there it is. <code>c2ad</code>. In Unicode that's <code>U+00AD</code> ­­­­­­- the <a href="http://www.fileformat.info/info/unicode/char/00ad/index.htm">soft hyphen</a>. You can see a demonstration of the soft hyphen on <a href="https://en.wikipedia.org/wiki/Soft_hyphen">wikipedia</a>.</p>
<p>Now that I found the character, I was able to remove it and the test succeeds. But that doesn't answer the two questions from above.</p>
<blockquote>
<p>How did that hyphen get there and why didn't it show up in Sublime Text?</p>
</blockquote>
<p>I frankly have no idea how the hyphen got there but I can make some guesses on why it doesn't show up. Firstly, it could be the font that doesn't support the soft hyphen. However, since I'm using the same font (Ubuntu Mono) for Sublime Text and urxvt, that's not possible. After all, the soft hyphen was displayed on the command line. My guess is that Sublime Text treats the character as an invisible character as the unicode standard suggests:</p>
<blockquote>
<p>Despite its name, U+00AD - soft hyphen is not a hyphen, but rather an invisible format character used to indicate optional intraword breaks. As described in Section 16.2, Layout Controls, its effect on the appearance of the text depends on the language and script used.
<small>The Unicode Consortium. The Unicode Standard.<br />
<a href="http://www.unicode.org/versions/latest/">http://www.unicode.org/versions/latest/</a></small></p>
</blockquote>
<h3 id="was-it-worthwhile">Was it worthwhile?</h3>
<p>Yes. I think that sometimes it is worth digging deep instead of reverting to a previous commit.
I'm still new to testing so looking into equality matchers surely didn't hurt. I also learned a lot about Unicode, which might come in handy at some point.</p>
<p>What about you? Do you revert to save time or do you prefer to get to the root of the issue? </p>
</div>
    </article>
    <hr />
    <div class="about-the-author">
      <img src="/assets/images/avatar.jpeg" height="200px" alt="avatar" class="avatar" />
      <div>
        <h2>Philipp Hansch</h2>
        <h4 class="subtitle">Full Stack Developer</h4>
        <p>
        Philipp is a full stack developer currently heavily involved with Rust. Most notably he's a member of the Clippy team where he helps with bugfixing and documentation. You can follow him on <a href="https://twitter.com/philhansch">Twitter</a> and find him on <a href="https://github.com/phansch">GitHub</a> as well as <a href="https://patreon.com/philhansch">Patreon</a>.
        </p>
      </div>
    </div>
  </div>

    </section>

    <footer>
      <div id="footer-content">
        <p>
          <a href="mailto:hi@phansch.net" rel="me" title="hi@phansch.net">mail</a> ::
          <a href="http://twitter.com/philhansch" rel="me" title="Follow me on Twitter">twitter</a> ::
          <a href="http://github.com/phansch" rel="me" title="Code">git</a> ::
          <a href="/archive/" title="More posts">archive</a> ::
          <a href="/atom.xml" title="RSS">feed</a> ::
          <a href="https://gist.github.com/phansch/db18a595d2f5f1ef16646af72fe1fb0e" title="Improved YARD Cheatsheet">yard cheatsheet</a>
        </p>
      </div>
    </footer>
  </body>
</html>
